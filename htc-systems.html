<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Reproducible Machine Learning Workflows for Scientists: Using Pixi environments on HTC Systems</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png"><link rel="manifest" href="favicons/incubator/site.webmanifest"><link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/htc-systems.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Reproducible Machine Learning Workflows for Scientists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Reproducible Machine Learning Workflows for Scientists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Reproducible Machine Learning Workflows for Scientists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 62%" class="percentage">
    62%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 62%" aria-valuenow="62" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/htc-systems.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Reproducible Research</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="pixi-intro.html">2. Introduction to Pixi</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="backwards-compatibility.html">3. Backwards compatibility with conda</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="conda-pacakges.html">4. Conda packages</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="cuda-conda-pacakges.html">5. CUDA conda packages</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="pixi-deployment.html">6. Deploying Pixi environments with Linux containers</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        7. Using Pixi environments on HTC Systems
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#high-throughput-computing-htc">High Throughput Computing (HTC)</a></li>
<li><a href="#setting-up-a-problem">Setting up a problem</a></li>
<li><a href="#htcondor">HTCondor</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="hpc-systems.html">8. Using Pixi environments on HPC Systems</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="pixi-deployment.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="hpc-systems.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="pixi-deployment.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Deploying Pixi
        </a>
        <a class="chapter-link float-end" href="hpc-systems.html" rel="next">
          Next: Using Pixi...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Using Pixi environments on HTC Systems</h1>
        <p>Last updated on 2025-10-28 |

        <a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/edit/main/episodes/htc-systems.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can you run workflows that use GPUs with Pixi CUDA environments
using HTCondor?</li>
<li>What solutions exist for the resources you have?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Learn how to submit containerized workflows to HTC systems.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="high-throughput-computing-htc">High Throughput Computing (HTC)<a class="anchor" aria-label="anchor" href="#high-throughput-computing-htc"></a></h2>
<hr class="half-width"><p>One of the most common forms of production computing is
<strong>high-throughput computing (HTC)</strong>, where computational
problems as distributed across multiple computing resources to
parallelize computations and reduce total compute time. HTC resources
are quite dynamic, but usually focus on smaller memory and disk
requirements on each individual worker compute node. This is in contrast
to <strong>high-performance computing (HPC)</strong> where there are
comparatively fewer compute nodes but the capabilities and associated
memory, disk, and bandwidth resources are much higher.</p>
<p>The most common HTC workflow management system is <a href="https://htcondor.org/" class="external-link">HTCondor</a>.</p>
</section><section><h2 class="section-heading" id="setting-up-a-problem">Setting up a problem<a class="anchor" aria-label="anchor" href="#setting-up-a-problem"></a></h2>
<hr class="half-width"><p>First let’s create a computing problem to apply these compute systems
to.</p>
<p>Let’s first create a new project in our Git repository</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="ex">pixi</span> init ~/pixi-cuda-lesson/htcondor</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="bu">cd</span> ~/pixi-cuda-lesson/htcondor</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Created ~/&lt;username&gt;/pixi-cuda-lesson/htcondor/pixi.toml</code></pre>
</div>
<div class="section level3">
<h3 id="training-a-pytorch-model-on-the-mnist-dataset">Training a PyTorch model on the MNIST dataset<a class="anchor" aria-label="anchor" href="#training-a-pytorch-model-on-the-mnist-dataset"></a></h3>
<p>Let’s write a very standard tutorial example of training a deep neral
network on the <a href="https://en.wikipedia.org/wiki/MNIST_database" class="external-link">MNIST dataset</a>
with PyTorch and then run it on GPUs in an HTCondor worker pool.</p>
<div id="mea-culpa-more-interesting-examples-exist" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<span class="callout-header">Caution</span>
<div id="mea-culpa-more-interesting-examples-exist" class="callout-inner">
<h3 class="callout-title">Mea culpa, more interesting examples
exist</h3>
<div class="callout-content">
<p>More exciting examples will be used in the future, but MNIST is
perhaps one of the most simple examples to illustrate a point.</p>
</div>
</div>
</div>
<div class="section level4">
<h4 id="the-neural-network-code">The neural network code<a class="anchor" aria-label="anchor" href="#the-neural-network-code"></a></h4>
<p>We’ll download Python code that uses a convocational neural network
written in PyTorch to learn to identify the handwritten number of the
MNIST dataset and place it under a <code>src/</code> directory. This is
a <a href="https://github.com/pytorch/examples/blob/main/mnist/main.py" class="external-link">modified
example from the PyTorch documentation</a> which is <a href="https://github.com/pytorch/examples/blob/abfa4f9cc4379de12f6c340538ef9a697332cccb/LICENSE" class="external-link">licensed
under the BSD 3-Clause license</a>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> src</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sL</span> https://github.com/matthewfeickert/nvidia-gpu-ml-library-test/raw/c7889222544928fb6f9fdeb1145767272b5cfec8/torch_MNIST.py <span class="at">-o</span> ./src/torch_MNIST.py</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sL</span> https://github.com/matthewfeickert/nvidia-gpu-ml-library-test/raw/36c725360b1b1db648d6955c27bd3885b29a3273/torch_detect_GPU.py <span class="at">-o</span> ./src/torch_detect_GPU.py</span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="the-pixi-environment">The Pixi environment<a class="anchor" aria-label="anchor" href="#the-pixi-environment"></a></h4>
<p>Now let’s think about what we need to use this code. Looking at the
imports of <code>src/torch_MNIST.py</code> we can see that
<code>torch</code> and <code>torchvision</code> are the only imported
libraries that aren’t part of the Python standard library, so we will
need to depend on PyTorch and <code>torchvision</code>. We also know
that we’d like to use CUDA accelerated code, so that we’ll need CUDA
libraries and versions of PyTorch that support CUDA.</p>
<div id="create-the-environment" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="create-the-environment" class="callout-inner">
<h3 class="callout-title">Create the environment</h3>
<div class="callout-content">
<p>Create a Pixi workspace that:</p>
<ul><li>Has PyTorch and <code>torchvision</code> in it.</li>
<li>Has the ability to support CUDA v12.</li>
<li>Has an environment that has the CPU version of PyTorch and
<code>torchvision</code> that can be installed on <code>linux-64</code>,
<code>osx-arm64</code>, and <code>win-64</code>.</li>
<li>Has an environment that has the GPU version of PyTorch and
<code>torchvision</code> that can be installed on <code>linux-64</code>,
and <code>win-64</code>.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>This is just expanding the exercises from the CUDA conda packages
episode.</p>
<p>Let’s first add all the platforms we want to work with to the
workspace</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="ex">pixi</span> workspace platform add linux-64 osx-arm64 win-64</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Added linux-64
✔ Added osx-arm64
✔ Added win-64</code></pre>
</div>
<p>Let’s add the CPU requirements to a feature named
<code>cpu</code></p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="ex">pixi</span> add <span class="at">--feature</span> cpu pytorch-cpu torchvision</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Added pytorch-cpu
✔ Added torchvision
Added these only for feature: cpu</code></pre>
</div>
<p>and then create an environment named <code>cpu</code> with that
feature</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="ex">pixi</span> workspace environment add <span class="at">--feature</span> cpu cpu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Added environment cpu</code></pre>
</div>
<p>and insatiate it with particular versions</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="ex">pixi</span> upgrade <span class="at">--feature</span> cpu</span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="kw">[workspace]</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="dt">channels</span> <span class="op">=</span> <span class="op">[</span><span class="st">"conda-forge"</span><span class="op">]</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"htcondor"</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="dt">platforms</span> <span class="op">=</span> <span class="op">[</span><span class="st">"linux-64"</span><span class="op">,</span> <span class="st">"osx-arm64"</span><span class="op">,</span> <span class="st">"win-64"</span><span class="op">]</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="kw">[tasks]</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a><span class="kw">[dependencies]</span></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="kw">[feature.cpu.dependencies]</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="dt">pytorch-cpu</span> <span class="op">=</span> <span class="st">"&gt;=2.7.1,&lt;3"</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a><span class="dt">torchvision</span> <span class="op">=</span> <span class="st">"&gt;=0.24.0,&lt;0.25"</span></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a></span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="kw">[environments]</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="dt">cpu</span> <span class="op">=</span> <span class="op">[</span><span class="st">"cpu"</span><span class="op">]</span></span></code></pre>
</div>
<p>Now let’s add the GPU environment and dependencies. Let’s start with
the CUDA system requirements</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="ex">pixi</span> workspace system-requirements add <span class="at">--feature</span> gpu cuda 12</span></code></pre>
</div>
<p>and create an environment from the feature</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="ex">pixi</span> workspace environment add <span class="at">--feature</span> gpu gpu</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Added environment gpu</code></pre>
</div>
<p>and then add the GPU dependencies for the target platform of
<code>linux-64</code> (where we’ll run in production).</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="ex">pixi</span> add <span class="at">--platform</span> linux-64 <span class="at">--platform</span> win-64 <span class="at">--feature</span> gpu pytorch-gpu torchvision</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>✔ Added pytorch-gpu &gt;=2.7.1,&lt;3
✔ Added torchvision &gt;=0.24.0,&lt;0.25
Added these only for platform(s): linux-64, win-64
Added these only for feature: gpu</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">TOML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode toml" tabindex="0"><code class="sourceCode toml"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="kw">[workspace]</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="dt">channels</span> <span class="op">=</span> <span class="op">[</span><span class="st">"conda-forge"</span><span class="op">]</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="dt">name</span> <span class="op">=</span> <span class="st">"htcondor"</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="dt">platforms</span> <span class="op">=</span> <span class="op">[</span><span class="st">"linux-64"</span><span class="op">,</span> <span class="st">"osx-arm64"</span><span class="op">,</span> <span class="st">"win-64"</span><span class="op">]</span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="dt">version</span> <span class="op">=</span> <span class="st">"0.1.0"</span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="kw">[tasks]</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="kw">[dependencies]</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="kw">[feature.cpu.dependencies]</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="dt">pytorch-cpu</span> <span class="op">=</span> <span class="st">"&gt;=2.7.1,&lt;3"</span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="dt">torchvision</span> <span class="op">=</span> <span class="st">"&gt;=0.24.0,&lt;0.25"</span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="kw">[feature.gpu.system-requirements]</span></span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a><span class="dt">cuda</span> <span class="op">=</span> <span class="st">"12"</span></span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a><span class="kw">[feature.gpu.target.linux-64.dependencies]</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a><span class="dt">pytorch-gpu</span> <span class="op">=</span> <span class="st">"&gt;=2.7.1,&lt;3"</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a><span class="dt">torchvision</span> <span class="op">=</span> <span class="st">"&gt;=0.24.0,&lt;0.25"</span></span>
<span id="cb17-21"><a href="#cb17-21" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" tabindex="-1"></a><span class="kw">[feature.gpu.target.win-64.dependencies]</span></span>
<span id="cb17-23"><a href="#cb17-23" tabindex="-1"></a><span class="dt">pytorch-gpu</span> <span class="op">=</span> <span class="st">"&gt;=2.7.1,&lt;3"</span></span>
<span id="cb17-24"><a href="#cb17-24" tabindex="-1"></a><span class="dt">torchvision</span> <span class="op">=</span> <span class="st">"&gt;=0.24.0,&lt;0.25"</span></span>
<span id="cb17-25"><a href="#cb17-25" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" tabindex="-1"></a><span class="kw">[environments]</span></span>
<span id="cb17-27"><a href="#cb17-27" tabindex="-1"></a><span class="dt">cpu</span> <span class="op">=</span> <span class="op">[</span><span class="st">"cpu"</span><span class="op">]</span></span>
<span id="cb17-28"><a href="#cb17-28" tabindex="-1"></a><span class="dt">gpu</span> <span class="op">=</span> <span class="op">[</span><span class="st">"gpu"</span><span class="op">]</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="override-the-__cuda-virtual-package" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<span class="callout-header">Caution</span>
<div id="override-the-__cuda-virtual-package" class="callout-inner">
<h3 class="callout-title">Override the <code>__cuda</code> virtual
package</h3>
<div class="callout-content">
<p>Remember that if you’re on a platform that doesn’t support the
<code>system-requirement</code> you’ll need to override the checks to
<strong>install</strong> the environment.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="bu">export</span> <span class="va">CONDA_OVERRIDE_CUDA</span><span class="op">=</span>12</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co"># CONDA_OVERRIDE_CUDA=12 pixi &lt;command&gt;</span></span></code></pre>
</div>
</div>
</div>
</div>
<p>To validate that things are working with the CPU code, let’s do a
short training run for only <code>2</code> epochs in the
<code>cpu</code> environment.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="ex">pixi</span> run <span class="at">--environment</span> cpu python src/torch_MNIST.py <span class="at">--epochs</span> 2 <span class="at">--save-model</span> <span class="at">--data-dir</span> data</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>100.0%
100.0%
100.0%
100.0%
Train Epoch: 1 [0/60000 (0%)]	Loss: 2.329474
Train Epoch: 1 [640/60000 (1%)]	Loss: 1.425185
Train Epoch: 1 [1280/60000 (2%)]	Loss: 0.826808
Train Epoch: 1 [1920/60000 (3%)]	Loss: 0.556883
Train Epoch: 1 [2560/60000 (4%)]	Loss: 0.483756
...
Train Epoch: 2 [57600/60000 (96%)]	Loss: 0.146226
Train Epoch: 2 [58240/60000 (97%)]	Loss: 0.016065
Train Epoch: 2 [58880/60000 (98%)]	Loss: 0.003342
Train Epoch: 2 [59520/60000 (99%)]	Loss: 0.001542

Test set: Average loss: 0.0351, Accuracy: 9874/10000 (99%)</code></pre>
</div>
<div id="running-multiple-ways" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="running-multiple-ways" class="callout-inner">
<h3 class="callout-title">Running multiple ways</h3>
<div class="callout-content">
<p>What’s another way we could have run this other than with
<code>pixi run</code>?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>You can enter a shell environment first</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="ex">pixi</span> shell <span class="at">--environment</span> cpu</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="ex">python</span> src/torch_MNIST.py <span class="at">--epochs</span> 2 <span class="at">--save-model</span> <span class="at">--data-dir</span> data</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="the-linux-container">The Linux container<a class="anchor" aria-label="anchor" href="#the-linux-container"></a></h4>
<div class="section level5">
<h5 id="apptainer">Apptainer<a class="anchor" aria-label="anchor" href="#apptainer"></a></h5>
<p>Let’s write an Apptainer definition file that installs the
<code>gpu</code> environment, and nothing else, into the container image
when built.</p>
<pre><code>Bootstrap: docker
From: ghcr.io/prefix-dev/pixi:noble
Stage: build

# %arguments have to be defined at each stage
%arguments
    CUDA_VERSION=12
    ENVIRONMENT=gpu

%files
./pixi.toml /app/
./pixi.lock /app/
./.gitignore /app/

%post
#!/bin/bash
export CONDA_OVERRIDE_CUDA={{ CUDA_VERSION }}
cd /app/
pixi info
pixi install --locked --environment {{ ENVIRONMENT }}
echo "#!/bin/bash" &gt; /app/entrypoint.sh &amp;&amp; \
pixi shell-hook --environment {{ ENVIRONMENT }} -s bash &gt;&gt; /app/entrypoint.sh &amp;&amp; \
echo 'exec "$@"' &gt;&gt; /app/entrypoint.sh


Bootstrap: docker
From: ghcr.io/prefix-dev/pixi:noble
Stage: final

%arguments
    ENVIRONMENT=gpu

%files from build
/app/.pixi/envs/{{ ENVIRONMENT }} /app/.pixi/envs/{{ ENVIRONMENT }}
/app/pixi.toml /app/pixi.toml
/app/pixi.lock /app/pixi.lock
/app/.gitignore /app/.gitignore
# The ignore files are needed for 'pixi run' to work in the container
/app/.pixi/.gitignore /app/.pixi/.gitignore
/app/.pixi/.condapackageignore /app/.pixi/.condapackageignore
/app/entrypoint.sh /app/entrypoint.sh

%post
#!/bin/bash
cd /app/
pixi info
chmod +x /app/entrypoint.sh

%runscript
#!/bin/bash
/app/entrypoint.sh "$@"

%startscript
#!/bin/bash
/app/entrypoint.sh "$@"

%test
#!/bin/bash -e
. /app/entrypoint.sh
pixi info
pixi list</code></pre>
</div>
<div class="section level5">
<h5 id="docker">Docker<a class="anchor" aria-label="anchor" href="#docker"></a></h5>
<p>Let’s write a <code>Dockerfile</code> that installs the
<code>gpu</code> environment into the container image when built.</p>
<div id="write-the-dockerfile" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="write-the-dockerfile" class="callout-inner">
<h3 class="callout-title">Write the Dockerfile</h3>
<div class="callout-content">
<p>Write a <code>Dockerfile</code> that will install the
<code>gpu</code> environment and only the <code>gpu</code> environment
into the container image.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="kw">ARG</span> CUDA_VERSION=<span class="st">"12"</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT=<span class="st">"gpu"</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/prefix-dev/pixi:noble <span class="kw">AS</span> build</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a><span class="kw">ARG</span> CUDA_VERSION</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT</span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb23-10"><a href="#cb23-10" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb23-11"><a href="#cb23-11" tabindex="-1"></a><span class="kw">ENV</span> CONDA_OVERRIDE_CUDA=$CUDA_VERSION</span>
<span id="cb23-12"><a href="#cb23-12" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pixi</span> install <span class="at">--locked</span> <span class="at">--environment</span> <span class="va">$ENVIRONMENT</span></span>
<span id="cb23-13"><a href="#cb23-13" tabindex="-1"></a><span class="kw">RUN</span> <span class="bu">echo</span> <span class="st">"#!/bin/bash"</span> <span class="op">&gt;</span> /app/entrypoint.sh <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb23-14"><a href="#cb23-14" tabindex="-1"></a>    <span class="ex">pixi</span> shell-hook <span class="at">--environment</span> <span class="va">$ENVIRONMENT</span> <span class="at">-s</span> bash <span class="op">&gt;&gt;</span> /app/entrypoint.sh <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb23-15"><a href="#cb23-15" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">'exec "$@"'</span> <span class="op">&gt;&gt;</span> /app/entrypoint.sh</span>
<span id="cb23-16"><a href="#cb23-16" tabindex="-1"></a></span>
<span id="cb23-17"><a href="#cb23-17" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/prefix-dev/pixi:noble <span class="kw">AS</span> final</span>
<span id="cb23-18"><a href="#cb23-18" tabindex="-1"></a></span>
<span id="cb23-19"><a href="#cb23-19" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT</span>
<span id="cb23-20"><a href="#cb23-20" tabindex="-1"></a></span>
<span id="cb23-21"><a href="#cb23-21" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb23-22"><a href="#cb23-22" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/envs/$ENVIRONMENT /app/.pixi/envs/$ENVIRONMENT</span>
<span id="cb23-23"><a href="#cb23-23" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/pixi.toml /app/pixi.toml</span>
<span id="cb23-24"><a href="#cb23-24" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/pixi.lock /app/pixi.lock</span>
<span id="cb23-25"><a href="#cb23-25" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/.gitignore /app/.pixi/.gitignore</span>
<span id="cb23-26"><a href="#cb23-26" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/.condapackageignore /app/.pixi/.condapackageignore</span>
<span id="cb23-27"><a href="#cb23-27" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> <span class="op">--chmod=0755</span> /app/entrypoint.sh /app/entrypoint.sh</span>
<span id="cb23-28"><a href="#cb23-28" tabindex="-1"></a></span>
<span id="cb23-29"><a href="#cb23-29" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [ <span class="st">"/app/entrypoint.sh"</span> ]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="section level4">
<h4 id="building-and-deploying-the-container-image">Building and deploying the container image<a class="anchor" aria-label="anchor" href="#building-and-deploying-the-container-image"></a></h4>
<p>Now let’s add a GitHub Actions pipeline to build the container image
definition files (apptainer.def and Dockerfile) and deploy it to a Linux
container registry.</p>
<div id="build-and-deploy-linux-container-image-to-registry" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<span class="callout-header">Challenge</span>
<div id="build-and-deploy-linux-container-image-to-registry" class="callout-inner">
<h3 class="callout-title">Build and deploy Linux container image to
registry</h3>
<div class="callout-content">
<p>Add a GitHub Actions pipeline that will build both the apptainer.def
and Dockerfile files deploy them to GitHub Container Registry
(<code>ghcr</code>). Have the image tags include the text
<code>mnist</code> as this will be the identifying problem.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>Create the GitHub Actions workflow directory tree</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> .github/workflows</span></code></pre>
</div>
<p>and then write a YAML file at
<code>.github/workflows/containers.yaml</code> that contains the
following:</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and publish Linux container images</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> main</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'v*'</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/pixi.toml'</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/pixi.lock'</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/apptainer.def'</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/Dockerfile'</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/.dockerignore'</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/pixi.toml'</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/pixi.lock'</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/apptainer.def'</span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/Dockerfile'</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'htcondor/.dockerignore'</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a><span class="at">  </span><span class="fu">release</span><span class="kw">:</span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a><span class="at">    </span><span class="fu">types</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">published</span><span class="kw">]</span></span>
<span id="cb25-24"><a href="#cb25-24" tabindex="-1"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb25-25"><a href="#cb25-25" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" tabindex="-1"></a><span class="fu">concurrency</span><span class="kw">:</span></span>
<span id="cb25-27"><a href="#cb25-27" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> ${{ github.workflow }}-${{ github.ref }}</span></span>
<span id="cb25-28"><a href="#cb25-28" tabindex="-1"></a><span class="at">  </span><span class="fu">cancel-in-progress</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb25-29"><a href="#cb25-29" tabindex="-1"></a></span>
<span id="cb25-30"><a href="#cb25-30" tabindex="-1"></a><span class="fu">permissions</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb25-31"><a href="#cb25-31" tabindex="-1"></a></span>
<span id="cb25-32"><a href="#cb25-32" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb25-33"><a href="#cb25-33" tabindex="-1"></a><span class="at">  </span><span class="fu">docker</span><span class="kw">:</span></span>
<span id="cb25-34"><a href="#cb25-34" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and publish Docker images</span></span>
<span id="cb25-35"><a href="#cb25-35" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb25-36"><a href="#cb25-36" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb25-37"><a href="#cb25-37" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb25-38"><a href="#cb25-38" tabindex="-1"></a><span class="at">      </span><span class="fu">packages</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb25-39"><a href="#cb25-39" tabindex="-1"></a></span>
<span id="cb25-40"><a href="#cb25-40" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb25-41"><a href="#cb25-41" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout</span></span>
<span id="cb25-42"><a href="#cb25-42" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb25-43"><a href="#cb25-43" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb25-44"><a href="#cb25-44" tabindex="-1"></a><span class="at">          </span><span class="fu">fetch-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb25-45"><a href="#cb25-45" tabindex="-1"></a></span>
<span id="cb25-46"><a href="#cb25-46" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Docker meta</span></span>
<span id="cb25-47"><a href="#cb25-47" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> meta</span></span>
<span id="cb25-48"><a href="#cb25-48" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/metadata-action@v5</span></span>
<span id="cb25-49"><a href="#cb25-49" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb25-50"><a href="#cb25-50" tabindex="-1"></a><span class="fu">          images</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb25-51"><a href="#cb25-51" tabindex="-1"></a>            ghcr.io/${{ github.repository }}</span>
<span id="cb25-52"><a href="#cb25-52" tabindex="-1"></a><span class="co">          # generate Docker tags based on the following events/attributes</span></span>
<span id="cb25-53"><a href="#cb25-53" tabindex="-1"></a><span class="fu">          tags</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb25-54"><a href="#cb25-54" tabindex="-1"></a>            type=raw,value=mnist-gpu-noble-cuda-12.9</span>
<span id="cb25-55"><a href="#cb25-55" tabindex="-1"></a>            type=raw,value=latest</span>
<span id="cb25-56"><a href="#cb25-56" tabindex="-1"></a>            type=sha</span>
<span id="cb25-57"><a href="#cb25-57" tabindex="-1"></a>            type=sha,prefix=mnist-gpu-noble-cuda-12.9-sha-</span>
<span id="cb25-58"><a href="#cb25-58" tabindex="-1"></a></span>
<span id="cb25-59"><a href="#cb25-59" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up QEMU</span></span>
<span id="cb25-60"><a href="#cb25-60" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-qemu-action@v3</span></span>
<span id="cb25-61"><a href="#cb25-61" tabindex="-1"></a></span>
<span id="cb25-62"><a href="#cb25-62" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb25-63"><a href="#cb25-63" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb25-64"><a href="#cb25-64" tabindex="-1"></a></span>
<span id="cb25-65"><a href="#cb25-65" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Login to GitHub Container Registry</span></span>
<span id="cb25-66"><a href="#cb25-66" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb25-67"><a href="#cb25-67" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v3</span></span>
<span id="cb25-68"><a href="#cb25-68" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb25-69"><a href="#cb25-69" tabindex="-1"></a><span class="at">          </span><span class="fu">registry</span><span class="kw">:</span><span class="at"> ghcr.io</span></span>
<span id="cb25-70"><a href="#cb25-70" tabindex="-1"></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ github.repository_owner }}</span></span>
<span id="cb25-71"><a href="#cb25-71" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb25-72"><a href="#cb25-72" tabindex="-1"></a></span>
<span id="cb25-73"><a href="#cb25-73" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test build</span></span>
<span id="cb25-74"><a href="#cb25-74" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> docker_build_test</span></span>
<span id="cb25-75"><a href="#cb25-75" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v6</span></span>
<span id="cb25-76"><a href="#cb25-76" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb25-77"><a href="#cb25-77" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> htcondor</span></span>
<span id="cb25-78"><a href="#cb25-78" tabindex="-1"></a><span class="at">          </span><span class="fu">file</span><span class="kw">:</span><span class="at"> htcondor/Dockerfile</span></span>
<span id="cb25-79"><a href="#cb25-79" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="cb25-80"><a href="#cb25-80" tabindex="-1"></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.labels }}</span></span>
<span id="cb25-81"><a href="#cb25-81" tabindex="-1"></a><span class="at">          </span><span class="fu">pull</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb25-82"><a href="#cb25-82" tabindex="-1"></a></span>
<span id="cb25-83"><a href="#cb25-83" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy build</span></span>
<span id="cb25-84"><a href="#cb25-84" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> docker_build_deploy</span></span>
<span id="cb25-85"><a href="#cb25-85" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v6</span></span>
<span id="cb25-86"><a href="#cb25-86" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb25-87"><a href="#cb25-87" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> htcondor</span></span>
<span id="cb25-88"><a href="#cb25-88" tabindex="-1"></a><span class="at">          </span><span class="fu">file</span><span class="kw">:</span><span class="at"> htcondor/Dockerfile</span></span>
<span id="cb25-89"><a href="#cb25-89" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="cb25-90"><a href="#cb25-90" tabindex="-1"></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.labels }}</span></span>
<span id="cb25-91"><a href="#cb25-91" tabindex="-1"></a><span class="at">          </span><span class="fu">pull</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb25-92"><a href="#cb25-92" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> ${{ github.event_name != 'pull_request' }}</span></span>
<span id="cb25-93"><a href="#cb25-93" tabindex="-1"></a></span>
<span id="cb25-94"><a href="#cb25-94" tabindex="-1"></a><span class="at">  </span><span class="fu">apptainer</span><span class="kw">:</span></span>
<span id="cb25-95"><a href="#cb25-95" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and publish Apptainer images</span></span>
<span id="cb25-96"><a href="#cb25-96" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb25-97"><a href="#cb25-97" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb25-98"><a href="#cb25-98" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb25-99"><a href="#cb25-99" tabindex="-1"></a><span class="at">      </span><span class="fu">packages</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb25-100"><a href="#cb25-100" tabindex="-1"></a></span>
<span id="cb25-101"><a href="#cb25-101" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb25-102"><a href="#cb25-102" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Free disk space</span></span>
<span id="cb25-103"><a href="#cb25-103" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> AdityaGarg8/remove-unwanted-software@v5</span></span>
<span id="cb25-104"><a href="#cb25-104" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb25-105"><a href="#cb25-105" tabindex="-1"></a><span class="at">          </span><span class="fu">remove-android</span><span class="kw">:</span><span class="at"> </span><span class="st">'true'</span></span>
<span id="cb25-106"><a href="#cb25-106" tabindex="-1"></a><span class="at">          </span><span class="fu">remove-dotnet</span><span class="kw">:</span><span class="at"> </span><span class="st">'true'</span></span>
<span id="cb25-107"><a href="#cb25-107" tabindex="-1"></a><span class="at">          </span><span class="fu">remove-haskell</span><span class="kw">:</span><span class="at"> </span><span class="st">'true'</span></span>
<span id="cb25-108"><a href="#cb25-108" tabindex="-1"></a></span>
<span id="cb25-109"><a href="#cb25-109" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout</span></span>
<span id="cb25-110"><a href="#cb25-110" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb25-111"><a href="#cb25-111" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb25-112"><a href="#cb25-112" tabindex="-1"></a><span class="at">          </span><span class="fu">fetch-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb25-113"><a href="#cb25-113" tabindex="-1"></a></span>
<span id="cb25-114"><a href="#cb25-114" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Get commit SHA</span></span>
<span id="cb25-115"><a href="#cb25-115" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> meta</span></span>
<span id="cb25-116"><a href="#cb25-116" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb25-117"><a href="#cb25-117" tabindex="-1"></a>            # Get the short commit SHA (first 7 characters)</span>
<span id="cb25-118"><a href="#cb25-118" tabindex="-1"></a>            SHA=$(git rev-parse --short HEAD)</span>
<span id="cb25-119"><a href="#cb25-119" tabindex="-1"></a>            echo "sha=sha-$SHA" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb25-120"><a href="#cb25-120" tabindex="-1"></a></span>
<span id="cb25-121"><a href="#cb25-121" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install Apptainer</span></span>
<span id="cb25-122"><a href="#cb25-122" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> eWaterCycle/setup-apptainer@v2</span></span>
<span id="cb25-123"><a href="#cb25-123" tabindex="-1"></a></span>
<span id="cb25-124"><a href="#cb25-124" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build container from definition file</span></span>
<span id="cb25-125"><a href="#cb25-125" tabindex="-1"></a><span class="at">        </span><span class="fu">working-directory</span><span class="kw">:</span><span class="at"> ./htcondor</span></span>
<span id="cb25-126"><a href="#cb25-126" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> apptainer build gpu-noble-cuda-12.9.sif apptainer.def</span></span>
<span id="cb25-127"><a href="#cb25-127" tabindex="-1"></a></span>
<span id="cb25-128"><a href="#cb25-128" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test container</span></span>
<span id="cb25-129"><a href="#cb25-129" tabindex="-1"></a><span class="at">        </span><span class="fu">working-directory</span><span class="kw">:</span><span class="at"> ./htcondor</span></span>
<span id="cb25-130"><a href="#cb25-130" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> apptainer test gpu-noble-cuda-12.9.sif</span></span>
<span id="cb25-131"><a href="#cb25-131" tabindex="-1"></a></span>
<span id="cb25-132"><a href="#cb25-132" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Login to GitHub Container Registry</span></span>
<span id="cb25-133"><a href="#cb25-133" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb25-134"><a href="#cb25-134" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v3</span></span>
<span id="cb25-135"><a href="#cb25-135" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb25-136"><a href="#cb25-136" tabindex="-1"></a><span class="at">          </span><span class="fu">registry</span><span class="kw">:</span><span class="at"> ghcr.io</span></span>
<span id="cb25-137"><a href="#cb25-137" tabindex="-1"></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ github.repository_owner }}</span></span>
<span id="cb25-138"><a href="#cb25-138" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb25-139"><a href="#cb25-139" tabindex="-1"></a></span>
<span id="cb25-140"><a href="#cb25-140" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy built container</span></span>
<span id="cb25-141"><a href="#cb25-141" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb25-142"><a href="#cb25-142" tabindex="-1"></a><span class="at">        </span><span class="fu">working-directory</span><span class="kw">:</span><span class="at"> ./htcondor</span></span>
<span id="cb25-143"><a href="#cb25-143" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> apptainer push gpu-noble-cuda-12.9.sif oras://ghcr.io/${{ github.repository }}:apptainer-mnist-gpu-noble-cuda-12.9-${{ steps.meta.outputs.sha }}</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="version-control" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="version-control" class="callout-inner">
<h3 class="callout-title">Version Control</h3>
<div class="callout-content">
<p>We now want to make sure that we can build container images with
these defention files and workflows.</p>
<p>On a <strong>new branch</strong> in your repository, add and commit
the files from this episode.</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a><span class="fu">git</span> add htcondor/pixi.<span class="pp">*</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="fu">git</span> add htcondor/.git<span class="pp">*</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a><span class="fu">git</span> add htcondor/apptainer.def</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a><span class="fu">git</span> add htcondor/Dockerfile.def</span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a><span class="fu">git</span> add .github/workflows/containers.yaml</span></code></pre>
</div>
<p>Then push your branch to your remote on GitHub</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin HEAD</span></code></pre>
</div>
<p>and make a pull request to merge your changes into your remote’s
default branch.</p>
</div>
</div>
</div>
<p>To verify that things are visible to other computers, install the
Linux container utility <a href="https://github.com/google/go-containerregistry/tree/main/cmd/crane" class="external-link"><code>crane</code></a></p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">pixi</span> global install crane</span></code></pre>
</div>
<pre class="console"><code>└── crane: 0.20.5 (installed)
    └─ exposes: crane</code></pre>
<p>and then use <a href="https://github.com/google/go-containerregistry/blob/main/cmd/crane/doc/crane_ls.md" class="external-link"><code>crane ls</code></a>
to list all of the Docker container images in your container registry
for the particular image</p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="ex">crane</span> ls ghcr.io/<span class="op">&lt;</span>your GitHub username<span class="op">&gt;</span>/pixi-cuda-lesson</span></code></pre>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="htcondor">HTCondor<a class="anchor" aria-label="anchor" href="#htcondor"></a></h2>
<hr class="half-width"><div id="this-episode-will-be-on-a-remote-system" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="this-episode-will-be-on-a-remote-system" class="callout-inner">
<h3 class="callout-title">This episode will be on a remote system</h3>
<div class="callout-content">
<p>All the computation in the rest of this episode will take place on a
remote system with a HTC workflow manager.</p>
</div>
</div>
</div>
<p>To provide a very high level overview of HTCondor in this episode
we’ll focus on only a few of its many resources and capabilities.</p>
<ol style="list-style-type: decimal"><li>Writing HTCondor execution scripts to define what the HTCondor
worker nodes will actually do.</li>
<li>Writing <a href="https://htcondor.readthedocs.io/en/latest/users-manual/submitting-a-job.html" class="external-link">HTCondor
submit description files</a> to send our jobs to the HTCondor worker
pool.</li>
<li>Submitting those jobs with <a href="https://htcondor.readthedocs.io/en/latest/man-pages/condor_submit.html" class="external-link"><code>condor_submit</code></a>
and monitoring them with <a href="https://htcondor.readthedocs.io/en/latest/man-pages/condor_q.html" class="external-link"><code>condor_q</code></a>.</li>
</ol><div id="connection-between-execution-scripts-and-submit-description-files" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<span class="callout-header">Caution</span>
<div id="connection-between-execution-scripts-and-submit-description-files" class="callout-inner">
<h3 class="callout-title">Connection between execution scripts and
submit description files</h3>
<div class="callout-content">
<p>As HTCondor execution scripts are given as the
<code>executable</code> field in HTCondor submit description files, they
are tightly linked and can not be written fully independently. Though
they are presented as separate steps above, you will in practice write
these together.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="write-the-htcondor-execution-script">Write the HTCondor execution script<a class="anchor" aria-label="anchor" href="#write-the-htcondor-execution-script"></a></h3>
<p>Let’s first start to write the execution script
<code>mnist_gpu_apptainer.sh</code>, as we can think about how that
relates to our code.</p>
<ul><li>We’ll be running in the <code>gpu</code> environment that we defined
with Pixi and built into our Apptainer container image.</li>
<li>For security reasons the HTCondor worker nodes don’t have full
connection to all of the internet. So we’ll need to transfer out input
data and source code rather than download it on demand.</li>
<li>We’ll need to activate the environment using the
<code>/app/entrypoint.sh</code> script we built into the Apptainer
container image.</li>
</ul><div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co"># mnist_gpu_apptainer.sh</span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="co"># detailed logging to stderr</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="bu">set</span> <span class="at">-x</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"# Hello from Job </span><span class="va">${1}</span><span class="st"> running on </span><span class="va">$(</span><span class="fu">hostname</span><span class="va">)</span><span class="st">\n"</span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"# GPUs assigned: </span><span class="va">${CUDA_VISIBLE_DEVICES}</span><span class="st">\n"</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"# Activate Pixi environment\n"</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="co"># The last line of the entrypoint.sh file is 'exec "$@"'. If this shell script</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="co"># receives arguments, exec will interpret them as arguments to it, which is not</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="co"># intended. To avoid this, strip the last line of entrypoint.sh and source that</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="co"># instead.</span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="bu">.</span> <span class="op">&lt;(</span><span class="fu">sed</span> <span class="st">'$d'</span> /app/entrypoint.sh<span class="op">)</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"# Check to see if the NVIDIA drivers can correctly detect the GPU:\n"</span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="ex">nvidia-smi</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"\n# Check that the training code exists:\n"</span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a><span class="fu">ls</span> <span class="at">-1ap</span> ./src/</span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"\n# Check if PyTorch can detect the GPU:\n"</span></span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a><span class="ex">python</span> ./src/torch_detect_GPU.py</span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"\n# Extract the training data:\n"</span></span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="st">"MNIST_data.tar.gz"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a>    <span class="fu">tar</span> <span class="at">-vxzf</span> MNIST_data.tar.gz</span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"The training data archive, MNIST_data.tar.gz, is not found."</span></span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">"Please transfer it to the worker node in the HTCondor jobs submission file."</span></span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a>    <span class="bu">exit</span> 1</span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a><span class="bu">echo</span> <span class="at">-e</span> <span class="st">"\n# Train MNIST with PyTorch:\n"</span></span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a><span class="bu">time</span> python ./src/torch_MNIST.py <span class="at">--data-dir</span> ./data <span class="at">--epochs</span> 14 <span class="at">--save-model</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="write-the-htcondor-submit-description-file">Write the HTCondor submit description file<a class="anchor" aria-label="anchor" href="#write-the-htcondor-submit-description-file"></a></h3>
<p>This is pretty standard boiler plate taken from the <a href="https://htcondor.readthedocs.io/en/latest/users-manual/submitting-a-job.html" class="external-link">HTCondor
documentation</a></p>
<pre class="condor"><code># mnist_gpu_apptainer.sub
# Submit file to access the GPU via apptainer

universe = container
container_image = oras://ghcr.io/&lt;github user name&gt;/pixi-cuda-lesson:apptainer-mnist-gpu-noble-cuda-12.9-sha-&lt;sha&gt;

# set the log, error and output files
log = mnist_gpu_apptainer_$(Cluster)_$(Process).log.txt
error = mnist_gpu_apptainer_$(Cluster)_$(Process).err.txt
output = mnist_gpu_apptainer_$(Cluster)_$(Process).out.txt

# set the executable to run
executable = mnist_gpu_apptainer.sh
arguments = $(Process)

+JobDurationCategory = "Medium"

# transfer training data files and runtime source files to the compute node
transfer_input_files = MNIST_data.tar.gz,src

# transfer the serialized trained model back
transfer_output_files = mnist_cnn.pt

should_transfer_files = YES
when_to_transfer_output = ON_EXIT

# Require a machine with a modern version of the CUDA driver
requirements = (GPUs_DriverVersion &gt;= 12.0)

# We must request 1 CPU in addition to 1 GPU
request_cpus = 1
request_gpus = 1

# select some memory and disk space
request_memory = 2GB
# Apptainer jobs take more disk than Docker jobs for some reason
request_disk = 7GB

# Optional: specify the GPU hardware architecture required
# Check against the CUDA GPU Compute Capability for your software
# e.g. python -c "import torch; print(torch.cuda.get_arch_list())"
# The listed 'sm_xy' values show the x.y gpu capability supported
gpus_minimum_capability = 5.0

# Optional: required GPU memory
gpus_minimum_memory = 2GB

# Tell HTCondor to run 1 instances of our job:
queue 1</code></pre>
</div>
<div class="section level3">
<h3 id="write-the-submission-script">Write the submission script<a class="anchor" aria-label="anchor" href="#write-the-submission-script"></a></h3>
<p>To make it easy for us, we can write a small job submission script
<code>submit.sh</code> that will prepare the data for us and submit the
submit description file to HTCondor for us with <a href="https://htcondor.readthedocs.io/en/latest/man-pages/condor_submit.html" class="external-link"><code>condor_submit</code></a>.</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="co"># submit.sh</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co"># Download the training data locally to transfer to the worker node</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">"MNIST_data.tar.gz"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb33-6"><a href="#cb33-6" tabindex="-1"></a>    <span class="co"># c.f. https://github.com/CHTC/templates-GPUs/blob/450081144c6ae0657123be2a9a357cb432d9d394/shared/pytorch/MNIST_data.tar.gz</span></span>
<span id="cb33-7"><a href="#cb33-7" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-sLO</span> https://raw.githubusercontent.com/CHTC/templates-GPUs/450081144c6ae0657123be2a9a357cb432d9d394/shared/pytorch/MNIST_data.tar.gz</span>
<span id="cb33-8"><a href="#cb33-8" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb33-9"><a href="#cb33-9" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" tabindex="-1"></a><span class="co"># Ensure existing models are backed up</span></span>
<span id="cb33-11"><a href="#cb33-11" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="st">"mnist_cnn.pt"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb33-12"><a href="#cb33-12" tabindex="-1"></a>    <span class="fu">mv</span> mnist_cnn.pt mnist_cnn_<span class="st">"</span><span class="va">$(</span><span class="fu">date</span> <span class="st">'+%Y-%m-%d-%H-%M'</span><span class="va">)</span><span class="st">"</span>.pt.bak</span>
<span id="cb33-13"><a href="#cb33-13" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb33-14"><a href="#cb33-14" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" tabindex="-1"></a><span class="ex">condor_submit</span> mnist_gpu_apptainer.sub</span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="submitting-the-job">Submitting the job<a class="anchor" aria-label="anchor" href="#submitting-the-job"></a></h3>
<p>Before we actually submit code to run, we can submit an interactive
job from the HTCondor system’s login nodes to check that things work as
expected.</p>
<div class="codewrapper sourceCode" id="cb34">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a><span class="co"># interact.sh</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a><span class="co"># Download the training data locally to transfer to the worker node</span></span>
<span id="cb34-5"><a href="#cb34-5" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">!</span> <span class="ot">-f</span> <span class="st">"MNIST_data.tar.gz"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb34-6"><a href="#cb34-6" tabindex="-1"></a>    <span class="co"># c.f. https://github.com/CHTC/templates-GPUs/blob/450081144c6ae0657123be2a9a357cb432d9d394/shared/pytorch/MNIST_data.tar.gz</span></span>
<span id="cb34-7"><a href="#cb34-7" tabindex="-1"></a>    <span class="ex">curl</span> <span class="at">-sLO</span> https://raw.githubusercontent.com/CHTC/templates-GPUs/450081144c6ae0657123be2a9a357cb432d9d394/shared/pytorch/MNIST_data.tar.gz</span>
<span id="cb34-8"><a href="#cb34-8" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb34-9"><a href="#cb34-9" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" tabindex="-1"></a><span class="co"># Ensure existing models are backed up</span></span>
<span id="cb34-11"><a href="#cb34-11" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="ot">-f</span> <span class="st">"mnist_cnn.pt"</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb34-12"><a href="#cb34-12" tabindex="-1"></a>    <span class="fu">mv</span> mnist_cnn.pt mnist_cnn_<span class="st">"</span><span class="va">$(</span><span class="fu">date</span> <span class="st">'+%Y-%m-%d-%H-%M'</span><span class="va">)</span><span class="st">"</span>.pt.bak</span>
<span id="cb34-13"><a href="#cb34-13" tabindex="-1"></a><span class="cf">fi</span></span>
<span id="cb34-14"><a href="#cb34-14" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" tabindex="-1"></a><span class="ex">condor_submit</span> <span class="at">-interactive</span> mnist_gpu_apptainer.sub</span></code></pre>
</div>
<p>Submitting the job for the first time will take a bit as it needs to
pull down the container image, so be patient. The container image will
be cached in the future and so this will be faster.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="fu">bash</span> interact.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitting job(s).
1 job(s) submitted to cluster 2127828.
Waiting for job to start...
...
Welcome to interactive3_1@vetsigian0001.chtc.wisc.edu!
Your condor job is running with pid(s) 2368233.
groups: cannot find name for group ID 24433
groups: cannot find name for group ID 40092
I have no name!@vetsigian0001:/var/lib/condor/execute/slot3/dir_2367762$</code></pre>
</div>
<p>We can now activate our environment manually and look around</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="bu">.</span> /app/entrypoint.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(htcondor:gpu) I have no name!@vetsigian0001:/var/lib/condor/execute/slot3/dir_2367762$</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb39">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="bu">command</span> <span class="at">-v</span> python</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>/app/.pixi/envs/gpu/bin/python</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb41">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="ex">python</span> <span class="at">--version</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Python 3.13.9</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="ex">pixi</span> list torch</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Environment: gpu
Package                     Version  Build                           Size       Kind   Source
libtorch                    2.7.1    cuda129_mkl_h9562ed8_304        836.3 MiB  conda  https://conda.anaconda.org/conda-forge/
pytorch                     2.7.1    cuda129_mkl_py313_h1e53aa0_304  28.1 MiB   conda  https://conda.anaconda.org/conda-forge/
pytorch-gpu                 2.7.1    cuda129_mkl_h43a4b0b_304        46.9 KiB   conda  https://conda.anaconda.org/conda-forge/
torchvision                 0.24.0   cuda129_py313_h6be0d2c_0        3.1 MiB    conda  https://conda.anaconda.org/conda-forge/
torchvision-extra-decoders  0.0.2    py313hf1e760e_3                 62.9 KiB   conda  https://conda.anaconda.org/conda-forge/</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="ex">pixi</span> list cuda</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Environment: gpu
Package               Version  Build       Size       Kind   Source
cuda-crt-tools        12.9.86  ha770c72_2  28.5 KiB   conda  https://conda.anaconda.org/conda-forge/
cuda-cudart           12.9.79  h5888daf_0  22.7 KiB   conda  https://conda.anaconda.org/conda-forge/
cuda-cudart_linux-64  12.9.79  h3f2d84a_0  192.6 KiB  conda  https://conda.anaconda.org/conda-forge/
cuda-cuobjdump        12.9.82  hffce074_1  239.3 KiB  conda  https://conda.anaconda.org/conda-forge/
cuda-cupti            12.9.79  h676940d_1  1.8 MiB    conda  https://conda.anaconda.org/conda-forge/
cuda-nvcc-tools       12.9.86  he02047a_2  26.1 MiB   conda  https://conda.anaconda.org/conda-forge/
cuda-nvdisasm         12.9.88  hffce074_1  5.3 MiB    conda  https://conda.anaconda.org/conda-forge/
cuda-nvrtc            12.9.86  hecca717_1  64.1 MiB   conda  https://conda.anaconda.org/conda-forge/
cuda-nvtx             12.9.79  hecca717_1  28.7 KiB   conda  https://conda.anaconda.org/conda-forge/
cuda-nvvm-tools       12.9.86  h4bc722e_2  23.1 MiB   conda  https://conda.anaconda.org/conda-forge/
cuda-version          12.9     h4f385c5_3  21.1 KiB   conda  https://conda.anaconda.org/conda-forge/</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="ex">nvidia-smi</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Thu Aug 14 06:36:21 2025
+-----------------------------------------------------------------------------------------+
| NVIDIA-SMI 555.42.06              Driver Version: 555.42.06      CUDA Version: 12.5     |
|-----------------------------------------+------------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id          Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |           Memory-Usage | GPU-Util  Compute M. |
|                                         |                        |               MIG M. |
|=========================================+========================+======================|
|   0  NVIDIA A100-PCIE-40GB          On  |   00000000:81:00.0 Off |                    0 |
| N/A   25C    P0             35W /  250W |       4MiB /  40960MiB |      0%      Default |
|                                         |                        |             Disabled |
+-----------------------------------------+------------------------+----------------------+

+-----------------------------------------------------------------------------------------+
| Processes:                                                                              |
|  GPU   GI   CI        PID   Type   Process name                              GPU Memory |
|        ID   ID                                                               Usage      |
|=========================================================================================|
|  No running processes found                                                             |
+-----------------------------------------------------------------------------------------+</code></pre>
</div>
<p>We can interactively run our code as well</p>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="fu">tar</span> <span class="at">-vxzf</span> MNIST_data.tar.gz</span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a><span class="bu">time</span> python ./src/torch_MNIST.py <span class="at">--data-dir</span> ./data <span class="at">--epochs</span> 2 <span class="at">--save-model</span></span></code></pre>
</div>
<p>To return to the login node we just <code>exit</code> the interactive
session</p>
<div class="codewrapper sourceCode" id="cb50">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="bu">exit</span></span></code></pre>
</div>
<p>Now to submit our job normally, we run the <code>submit.sh</code>
script</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="fu">bash</span> submit.sh</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Submitting job(s).
1 job(s) submitted to cluster 12651114.</code></pre>
</div>
<p>and its submission and state can be monitored with <a href="https://htcondor.readthedocs.io/en/latest/man-pages/condor_q.html" class="external-link"><code>condor_q</code></a>.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="ex">condor_q</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>

-- Schedd: ap40.uw.osg-htc.org : &lt;128.105.68.62:9618?... @ 08/14/25 08:20:12
OWNER            BATCH_NAME      SUBMITTED   DONE   RUN    IDLE  TOTAL JOB_IDS
matthew.feickert ID: 12651114   8/14 08:18      _      1      _      1 12651114.0

1 jobs; 0 completed, 0 removed, 0 idle, 1 running, 0 held, 0 suspended
</code></pre>
</div>
<p>When the job finishes we see that HTCondor has returned to us the
following files:</p>
<ul><li>
<code>mnist_gpu_apptainer_$(Cluster)_$(Process).log.txt</code>: the
HTCondor log file for the job</li>
<li>
<code>mnist_gpu_apptainer_$(Cluster)_$(Process).out.txt</code>: the
stdout of all actions executed in the job</li>
<li>
<code>mnist_gpu_apptainer_$(Cluster)_$(Process).err.txt</code>: the
stderr of all actions executed in the job</li>
<li>
<code>mnist_cnn.pt</code>: the <a href="https://docs.pytorch.org/tutorials/beginner/saving_loading_models.html#saving-loading-model-for-inference" class="external-link">serialized
trained PyTorch model</a>
</li>
</ul><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>You can use containerized Pixi environments with HTC systems to be
able to run CUDA accelerated code that you defined.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="pixi-deployment.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="hpc-systems.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="pixi-deployment.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Deploying Pixi
        </a>
        <a class="chapter-link float-end" href="hpc-systems.html" rel="next">
          Next: Using Pixi...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/edit/main/episodes/htc-systems.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:matthew.feickert@cern.ch">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://carpentries-incubator.github.io/reproducible-ml-workflows/htc-systems.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, lesson, The Carpentries, machine learning, CUDA, hardware acceleration, reproducible",
  "name": "Using Pixi environments on HTC Systems",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/reproducible-ml-workflows/htc-systems.html",
  "identifier": "https://carpentries-incubator.github.io/reproducible-ml-workflows/htc-systems.html",
  "dateCreated": "2025-03-16",
  "dateModified": "2025-10-28",
  "datePublished": "2025-10-28"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

