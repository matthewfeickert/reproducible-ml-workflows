<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Reproducible Machine Learning Workflows for Scientists: Deploying Pixi environments with Linux containers</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="../assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicons/incubator/favicon-16x16.png"><link rel="manifest" href="../favicons/incubator/site.webmanifest"><link rel="mask-icon" href="../favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Lesson Description" src="../assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../pixi-deployment.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Lesson Description" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Reproducible Machine Learning Workflows for Scientists
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Reproducible Machine Learning Workflows for Scientists
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="../instructor/aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Reproducible Machine Learning Workflows for Scientists
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 55%" class="percentage">
    55%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 55%" aria-valuenow="55" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../pixi-deployment.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Reproducible Research</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="pixi-intro.html">2. Introduction to Pixi</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="backwards-compatibility.html">3. Backwards compatibility with conda</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="conda-pacakges.html">4. Conda packages</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="cuda-conda-pacakges.html">5. CUDA conda packages</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Deploying Pixi environments with Linux containers
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#deploying-pixi-environments">Deploying Pixi environments</a></li>
<li><a href="#building-linux-containers-with-pixi-environments">Building Linux containers with Pixi environments</a></li>
<li><a href="#building-docker-containers-with-pixi-environments">Building Docker containers with Pixi environments</a></li>
<li><a href="#building-apptainer-containers-with-pixi-environments">Building Apptainer containers with Pixi environments</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="htc-systems.html">7. Using Pixi environments on HTC Systems</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="../instructor/aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/cuda-conda-pacakges.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/htc-systems.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/cuda-conda-pacakges.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: CUDA conda packages
        </a>
        <a class="chapter-link float-end" href="../instructor/htc-systems.html" rel="next">
          Next: Using Pixi...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Deploying Pixi environments with Linux containers</h1>
        <p>Last updated on 2025-10-28 |

        <a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/edit/main/episodes/pixi-deployment.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 45 minutes</p>

        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can Pixi environment be deployed to production compute
facilities?</li>
<li>What tools can be used to achieve this?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Version control Pixi environments with Git.</li>
<li>Create a Linux container that has a production environment.</li>
<li>Create an automated GitHub Actions workflow to build and deploy
environments.</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="deploying-pixi-environments">Deploying Pixi environments<a class="anchor" aria-label="anchor" href="#deploying-pixi-environments"></a></h2>
<hr class="half-width"><p>We now know how to create Pixi workspaces that contain environments
that can support CUDA enabled code. However, unless your production
machine learning environment is a lab desktop with GPUs and lots of disk
<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> that
you can install Pixi on and run your code then we still need to be able
to get our Pixi environments to our production machines.</p>
<p>There is one very straightforward solution:</p>
<ol style="list-style-type: decimal"><li>Version control your Pixi manifest and Pixi lock files with your
analysis code with a version control system (e.g. Git).</li>
<li>Clone your repository to the machine that you want to run on.</li>
<li>Install Pixi onto that machine.</li>
<li>Install the locked Pixi environment that you want to use.</li>
<li>Execute your code in the installed environment.</li>
</ol><p>That’s a nice and simple story, and it can work! However, in most
realistic scenarios the worker compute nodes that are executing code
share resource pools of storage and memory and are regulated to smaller
allotments of both. CUDA binaries are relatively large files and amount
of memory and storage to just unpack them can easily exceed a standard 2
GB memory limit on most high throughput computing (HTC) facility worker
nodes. This also requires direct access to the public internet, or for
you to setup a <a href="https://pixi.sh/latest/deployment/s3/" class="external-link">S3 object
store</a> behind your compute facility’s firewall with all of your conda
packages mirrored into it. In many scenarios, public internet access at
HTC and high performance computing (HPC) facilities is limited to only a
select “allow list” of websites or it might be fully restricted for
users.</p>
</section><section><h2 class="section-heading" id="building-linux-containers-with-pixi-environments">Building Linux containers with Pixi environments<a class="anchor" aria-label="anchor" href="#building-linux-containers-with-pixi-environments"></a></h2>
<hr class="half-width"><p>A more standard and robust way of distributing computing environments
is the use of <a href="https://pixi.sh/latest/deployment/container/" class="external-link">Linux container</a>
technology — like Docker or Apptainer.</p>
<div id="conceptualizing-the-role-of-linux-containers" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="conceptualizing-the-role-of-linux-containers" class="callout-inner">
<h3 class="callout-title">Conceptualizing the role of Linux
containers</h3>
<div class="callout-content">
<p>Linux containers are powerful technologies that allow for arbitrary
software environments to be distributed as a single binary. However, it
is important to <strong>not</strong> think of Linux containers as
<em>packaging</em> technologies (like conda packages) but as
<em>distribution</em> technologies. When you build a Linux container you
provide a set of imperative commands as a build script that constructs
different layers of the container. When the build is finished, all
layers of the build are compressed together to form a container image
binary that can be distributed through Linux container image
registries.</p>
<p>Packaging technologies allow for defining requirements and
constraints on a unit of software that we call a “package”. Packages can
be installed together and their metadata allows them to be composed
programmatically into software environments.</p>
<p>Linux containers take defined software environments and instantiate
them by installing them into the container image during the build and
then distribute that entire computing environment for a <strong>single
platform</strong>.</p>
</div>
</div>
</div>
<div id="resources-on-linux-containers" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="resources-on-linux-containers" class="callout-inner">
<h3 class="callout-title">Resources on Linux containers</h3>
<div class="callout-content">
<p>Linux containers are a full topic unto themselves and we won’t cover
them in this lesson. If you’re not familiar with Linux containers, here
are introductory resources:</p>
<ul><li>
<a href="https://carpentries-incubator.github.io/docker-introduction/" class="external-link">Reproducible
Computational Environments Using Containers: Introduction to Docker</a>,
a <a href="https://github.com/carpentries-incubator/proposals/#the-carpentries-incubator" class="external-link">The
Carpentries Incubator</a> lesson</li>
<li>
<a href="https://hsf-training.github.io/hsf-training-docker/index.html" class="external-link">Introduction
to Docker and Podman</a> by the <a href="https://hepsoftwarefoundation.org/" class="external-link">High Energy Physics Software
Foundation</a>
</li>
<li>
<a href="https://carpentries-incubator.github.io/apptainer-introduction/" class="external-link">Reproducible
computational environments using containers: Introduction to
Apptainer</a>, a <a href="https://github.com/carpentries-incubator/proposals/#the-carpentries-incubator" class="external-link">The
Carpentries Incubator</a> lesson</li>
</ul></div>
</div>
</div>
<p>If you don’t have a Linux container runtime on your machine don’t
worry — for the first part of this episode you can follow along reading
and then we’ll transition to automation.</p>
</section><section><h2 class="section-heading" id="building-docker-containers-with-pixi-environments">Building Docker containers with Pixi environments<a class="anchor" aria-label="anchor" href="#building-docker-containers-with-pixi-environments"></a></h2>
<hr class="half-width"><p>Docker is a very common Linux container runtime technology and Linux
container builder. We can use <a href="https://docs.docker.com/build/" class="external-link"><code>docker build</code></a> to
build a Linux container from a <code>Dockerfile</code> instruction file.
Luckily, to install Pixi environments into Docker container images there
is <strong>effectively only one <code>Dockerfile</code> recipe</strong>
that needs to be used, and then can be reused across projects.</p>
<div id="moving-files" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="moving-files" class="callout-inner">
<h3 class="callout-title">Moving files</h3>
<div class="callout-content">
<p>To use it later, we’ll place the <code>torch_detect_GPU.py</code>
code from the end of the CUDA conda packages episode at
<code>./app/torch_detect_GPU.py</code>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> app</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sL</span> https://github.com/matthewfeickert/nvidia-gpu-ml-library-test/raw/36c725360b1b1db648d6955c27bd3885b29a3273/torch_detect_GPU.py <span class="at">-o</span> ./app/torch_detect_GPU.py</span></code></pre>
</div>
</div>
</div>
</div>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># Declare build ARGs in global scope</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="kw">ARG</span> CUDA_VERSION=<span class="st">"12"</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT=<span class="st">"gpu"</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/prefix-dev/pixi:noble <span class="kw">AS</span> build</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># Redeclaring ARGs in a stage without a value inherits the global default</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="kw">ARG</span> CUDA_VERSION</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="kw">COPY</span> . .</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="kw">ENV</span> CONDA_OVERRIDE_CUDA=$CUDA_VERSION</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pixi</span> install <span class="at">--locked</span> <span class="at">--environment</span> <span class="va">$ENVIRONMENT</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="kw">RUN</span> <span class="bu">echo</span> <span class="st">"#!/bin/bash"</span> <span class="op">&gt;</span> /app/entrypoint.sh <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>    <span class="ex">pixi</span> shell-hook <span class="at">--environment</span> <span class="va">$ENVIRONMENT</span> <span class="at">-s</span> bash <span class="op">&gt;&gt;</span> /app/entrypoint.sh <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">'exec "$@"'</span> <span class="op">&gt;&gt;</span> /app/entrypoint.sh</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/prefix-dev/pixi:noble <span class="kw">AS</span> final</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/envs/$ENVIRONMENT /app/.pixi/envs/$ENVIRONMENT</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/pixi.toml /app/pixi.toml</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/pixi.lock /app/pixi.lock</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co"># The ignore files are needed for 'pixi run' to work in the container</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/.gitignore /app/.pixi/.gitignore</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/.condapackageignore /app/.pixi/.condapackageignore</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> <span class="op">--chmod=0755</span> /app/entrypoint.sh /app/entrypoint.sh</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co"># This bit is needed only if you have code you _want_ to deploy in the container.</span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co"># This is rare as you normally want your code to be able to get brought into a container later.</span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="kw">COPY</span> ./app /app/src</span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [ <span class="st">"/app/entrypoint.sh"</span> ]</span></code></pre>
</div>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Dockerfile walkthrough
  </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>Let’s step through this to understand what’s happening.
<code>Dockerfile</code>s (intentionally) look very shell script like,
and so we can read most of it as if we were typing the commands directly
into a shell (e.g. Bash).</p>
<ul><li><p>The <code>Dockerfile</code> assumes it is being built from a
version control repository where any code that it will need to execute
later exists under the repository’s <code>src/</code> directory and the
Pixi workspace’s <code>pixi.toml</code> manifest file and
<code>pixi.lock</code> lock file exist at the top level of the
repository.</p></li>
<li><p>Dockerfile <a href="https://docs.docker.com/reference/dockerfile/#arg" class="external-link"><code>ARG</code></a>s
are declared <em>before</em> the <code>build</code> stage’s base image
<code>FROM</code> declaration, meaning they have <a href="https://docs.docker.com/build/building/variables/#scoping" class="external-link">global
scope</a>. Declaring the <code>ARG</code>s again with no value in the
local scope of the <code>build</code> stage inherits the global scope
values.</p></li>
</ul><div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Declare build ARGS in global scope</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="kw">ARG</span> CUDA_VERSION=<span class="st">"12"</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT=<span class="st">"gpu"</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/prefix-dev/pixi:noble <span class="kw">AS</span> build</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Redeclaring ARGs in a stage without a value inherits the global default</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="kw">ARG</span> CUDA_VERSION</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT</span></code></pre>
</div>
<ul><li>The entire repository contents are <a href="https://docs.docker.com/reference/dockerfile/#copy" class="external-link"><code>COPY</code></a>ed
from the container build context into the <code>/app</code> directory of
the container build.</li>
</ul><div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="kw">COPY</span> . .</span></code></pre>
</div>
<ul><li>It is not reasonable to expect that the container image build
machine contains GPUs. To have Pixi still be able to install an
environment that uses CUDA when there is no virtual package set the
<code>__cuda</code> <a href="https://docs.conda.io/projects/conda/en/stable/user-guide/tasks/manage-virtual.html#overriding-detected-packages" class="external-link">override
environment variable <code>CONDA_OVERRIDE_CUDA</code></a>.</li>
</ul><div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="kw">ENV</span> CONDA_OVERRIDE_CUDA=$CUDA_VERSION</span></code></pre>
</div>
<ul><li>The <code>Dockerfile</code> uses a <a href="https://docs.docker.com/build/building/multi-stage/" class="external-link">multi-stage</a>
build where it first installs the target environment
<code>$ENVIRONMENT</code> and then creates an <a href="https://docs.docker.com/reference/dockerfile/#entrypoint" class="external-link"><code>ENTRYPOINT</code></a>
script using <a href="https://pixi.sh/latest/reference/cli/pixi/shell-hook/" class="external-link"><code>pixi shell-hook</code></a>
to automatically activate the environment when the container image is
run.</li>
</ul><div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="kw">RUN</span> <span class="ex">pixi</span> install <span class="at">--locked</span> <span class="at">--environment</span> <span class="va">$ENVIRONMENT</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="kw">RUN</span> <span class="bu">echo</span> <span class="st">"#!/bin/bash"</span> <span class="op">&gt;</span> /app/entrypoint.sh <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>    <span class="ex">pixi</span> shell-hook <span class="at">--environment</span> <span class="va">$ENVIRONMENT</span> <span class="at">-s</span> bash <span class="op">&gt;&gt;</span> /app/entrypoint.sh <span class="kw">&amp;&amp;</span> <span class="dt">\</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>    <span class="bu">echo</span> <span class="st">'exec "$@"'</span> <span class="op">&gt;&gt;</span> /app/entrypoint.sh</span></code></pre>
</div>
<ul><li>The next stage of the build starts from a new container instance and
then <a href="https://docs.docker.com/reference/dockerfile/#copy" class="external-link"><code>COPY</code></a>s
the installed environment and files <strong>from</strong> the build
container image into the production container image. This can reduce the
total size of the final container image if there were additional build
tools that needed to get installed in the build phase that aren’t
required for runtime in production.</li>
</ul><div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">FROM</span> ghcr.io/prefix-dev/pixi:noble <span class="kw">AS</span> final</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="kw">ARG</span> ENVIRONMENT</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="kw">WORKDIR</span> /app</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/envs/$ENVIRONMENT /app/.pixi/envs/$ENVIRONMENT</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/pixi.toml /app/pixi.toml</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/pixi.lock /app/pixi.lock</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co"># The ignore files are needed for 'pixi run' to work in the container</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/.gitignore /app/.pixi/.gitignore</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> /app/.pixi/.condapackageignore /app/.pixi/.condapackageignore</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a><span class="kw">COPY</span> <span class="op">--from=build</span> <span class="op">--chmod=0755</span> /app/entrypoint.sh /app/entrypoint.sh</span></code></pre>
</div>
<ul><li>Code that is specific to application purposes (e.g. environment
diagnostics) from the repository is <a href="https://docs.docker.com/reference/dockerfile/#copy" class="external-link"><code>COPY</code></a>ed
into the final container image as well</li>
</ul><div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="kw">COPY</span> ./app /app/src</span></code></pre>
</div>
<div id="knowing-what-code-to-copy" class="callout caution">
<div class="callout-square">
<i class="callout-icon" data-feather="alert-triangle"></i>
</div>
<span class="callout-header">Caution</span>
<div id="knowing-what-code-to-copy" class="callout-inner">
<h3 class="callout-title">Knowing what code to copy</h3>
<div class="callout-content">
<p>Generally you do <strong>not</strong> want to containerize your
development source code, as you’d like to be able to quickly iterate on
it and have it be transferred into a Linux container to be
evaluated.</p>
<p>You <strong>do</strong> want to containerize your development source
code if you’d like to archive it as an executable into the future.</p>
</div>
</div>
</div>
<ul><li>The <a href="https://docs.docker.com/reference/dockerfile/#entrypoint" class="external-link"><code>ENTRYPOINT</code></a>
script is set for activation</li>
</ul><div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">DOCKERFILE<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode dockerfile" tabindex="0"><code class="sourceCode dockerfile"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="kw">ENTRYPOINT</span> [ <span class="st">"/app/entrypoint.sh"</span> ]</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>With this <code>Dockerfile</code> the container image can then be
built with <a href="https://docs.docker.com/reference/cli/docker/buildx/build/" class="external-link"><code>docker build</code></a>.</p>
<pre><code>docker build --file Dockerfile --tag &lt;container image name:tag&gt; .</code></pre>
<p>and can optionally have the <code>ARG</code> variables set at build
time with</p>
<pre><code>docker build --build-arg CUDA_VERSION=12 --build-arg ENVIRONMENT=gpu --file Dockerfile --tag &lt;container image name:tag&gt; .</code></pre>
<div class="section level3">
<h3 id="automation-with-github-actions-workflows">Automation with GitHub Actions workflows<a class="anchor" aria-label="anchor" href="#automation-with-github-actions-workflows"></a></h3>
<p>In the personal GitHub repository that we’ve been working in, create
a GitHub Actions workflow directory from the top level of the
repository</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> .github/workflows</span></code></pre>
</div>
<p>and then add the following workflow file as
<code>.github/workflows/docker.yaml</code></p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Docker Images</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> main</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'v*'</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/pixi.toml'</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/pixi.lock'</span></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/Dockerfile'</span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/.dockerignore'</span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/app/**'</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/pixi.toml'</span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/pixi.lock'</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/Dockerfile'</span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/.dockerignore'</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/app/**'</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="at">  </span><span class="fu">release</span><span class="kw">:</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="at">    </span><span class="fu">types</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">published</span><span class="kw">]</span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="fu">concurrency</span><span class="kw">:</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> ${{ github.workflow }}-${{ github.ref }}</span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="at">  </span><span class="fu">cancel-in-progress</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="fu">permissions</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="at">  </span><span class="fu">docker</span><span class="kw">:</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and publish images</span></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a><span class="at">      </span><span class="fu">packages</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout</span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a><span class="at">          </span><span class="fu">fetch-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Docker meta</span></span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> meta</span></span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/metadata-action@v5</span></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a><span class="fu">          images</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a>            ghcr.io/${{ github.repository }}</span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a><span class="co">          # generate Docker tags based on the following events/attributes</span></span>
<span id="cb13-53"><a href="#cb13-53" tabindex="-1"></a><span class="fu">          tags</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb13-54"><a href="#cb13-54" tabindex="-1"></a>            type=raw,value=gpu-noble-cuda-12.9</span>
<span id="cb13-55"><a href="#cb13-55" tabindex="-1"></a>            type=raw,value=latest</span>
<span id="cb13-56"><a href="#cb13-56" tabindex="-1"></a>            type=sha</span>
<span id="cb13-57"><a href="#cb13-57" tabindex="-1"></a>            type=sha,prefix=gpu-noble-cuda-12.9-sha-</span>
<span id="cb13-58"><a href="#cb13-58" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up QEMU</span></span>
<span id="cb13-60"><a href="#cb13-60" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-qemu-action@v3</span></span>
<span id="cb13-61"><a href="#cb13-61" tabindex="-1"></a></span>
<span id="cb13-62"><a href="#cb13-62" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Set up Docker Buildx</span></span>
<span id="cb13-63"><a href="#cb13-63" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/setup-buildx-action@v3</span></span>
<span id="cb13-64"><a href="#cb13-64" tabindex="-1"></a></span>
<span id="cb13-65"><a href="#cb13-65" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Login to GitHub Container Registry</span></span>
<span id="cb13-66"><a href="#cb13-66" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb13-67"><a href="#cb13-67" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v3</span></span>
<span id="cb13-68"><a href="#cb13-68" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb13-69"><a href="#cb13-69" tabindex="-1"></a><span class="at">          </span><span class="fu">registry</span><span class="kw">:</span><span class="at"> ghcr.io</span></span>
<span id="cb13-70"><a href="#cb13-70" tabindex="-1"></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ github.repository_owner }}</span></span>
<span id="cb13-71"><a href="#cb13-71" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb13-72"><a href="#cb13-72" tabindex="-1"></a></span>
<span id="cb13-73"><a href="#cb13-73" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test build</span></span>
<span id="cb13-74"><a href="#cb13-74" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> docker_build_test</span></span>
<span id="cb13-75"><a href="#cb13-75" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v6</span></span>
<span id="cb13-76"><a href="#cb13-76" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb13-77"><a href="#cb13-77" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> cuda-exercise</span></span>
<span id="cb13-78"><a href="#cb13-78" tabindex="-1"></a><span class="at">          </span><span class="fu">file</span><span class="kw">:</span><span class="at"> cuda-exercise/Dockerfile</span></span>
<span id="cb13-79"><a href="#cb13-79" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="cb13-80"><a href="#cb13-80" tabindex="-1"></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.labels }}</span></span>
<span id="cb13-81"><a href="#cb13-81" tabindex="-1"></a><span class="at">          </span><span class="fu">pull</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-82"><a href="#cb13-82" tabindex="-1"></a></span>
<span id="cb13-83"><a href="#cb13-83" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy build</span></span>
<span id="cb13-84"><a href="#cb13-84" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> docker_build_deploy</span></span>
<span id="cb13-85"><a href="#cb13-85" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/build-push-action@v6</span></span>
<span id="cb13-86"><a href="#cb13-86" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb13-87"><a href="#cb13-87" tabindex="-1"></a><span class="at">          </span><span class="fu">context</span><span class="kw">:</span><span class="at"> cuda-exercise</span></span>
<span id="cb13-88"><a href="#cb13-88" tabindex="-1"></a><span class="at">          </span><span class="fu">file</span><span class="kw">:</span><span class="at"> cuda-exercise/Dockerfile</span></span>
<span id="cb13-89"><a href="#cb13-89" tabindex="-1"></a><span class="at">          </span><span class="fu">tags</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.tags }}</span></span>
<span id="cb13-90"><a href="#cb13-90" tabindex="-1"></a><span class="at">          </span><span class="fu">labels</span><span class="kw">:</span><span class="at"> ${{ steps.meta.outputs.labels }}</span></span>
<span id="cb13-91"><a href="#cb13-91" tabindex="-1"></a><span class="at">          </span><span class="fu">pull</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb13-92"><a href="#cb13-92" tabindex="-1"></a><span class="at">          </span><span class="fu">push</span><span class="kw">:</span><span class="at"> ${{ github.event_name != 'pull_request' }}</span></span></code></pre>
</div>
<p>This will build your Dockerfile in GitHub Actions CI into a <a href="https://docs.docker.com/build/building/multi-platform/" class="external-link"><code>linux/amd64</code>
platform</a> Docker container image and then deploy it to the <a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry" class="external-link">GitHub
Container Registry</a> (<code>ghcr</code>) associated with your
repository.</p>
<div id="version-control" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="version-control" class="callout-inner">
<h3 class="callout-title">Version Control</h3>
<div class="callout-content">
<p>We now want to use these tools to build our Pixi environment into a
Docker Linux container.</p>
<p>On a <strong>new branch</strong> in your repository, add and commit
the files from this episode.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="fu">git</span> add cuda-exercise/app</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="fu">git</span> add cuda-exercise/Dockerfile</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="fu">git</span> add .github</span></code></pre>
</div>
<p>Then push your branch to your remote on GitHub</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin HEAD</span></code></pre>
</div>
<p>and make a pull request to merge your changes into your remote’s
default branch.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="building-apptainer-containers-with-pixi-environments">Building Apptainer containers with Pixi environments<a class="anchor" aria-label="anchor" href="#building-apptainer-containers-with-pixi-environments"></a></h2>
<hr class="half-width"><p>Most HTC and HPC systems do not allow users to use Docker given
security risks and instead use Apptainer. In most situations, Apptainer
is able to automatically convert a Docker image, or other Open Container
Initiative (OCI) container image format, to Apptainer’s <a href="https://github.com/apptainer/sif" class="external-link">Singularity Image Format</a>
<code>.sif</code> container image format, and so no additional work is
required. However, the overlay system of Apptainer is different from
Docker, which means that the <code>ENTRYPOINT</code> of a Docker
container image might not get correctly translated into an Apptainer
<code>runscript</code> and <code>startscript</code>. In might be
advantageous, depending on your situation, to instead write an <a href="https://apptainer.org/docs/user/main/definition_files.html" class="external-link">Apptainer
<code>.def</code> definition file</a>, giving full control over the
commands, and then build that <code>.def</code> file into an
<code>.sif</code> Apptainer container image.</p>
<p>We can build a very similar <code>apptainer.def</code> Apptainer
container image definition file to the Dockerfile we wrote</p>
<pre><code>Bootstrap: docker
From: ghcr.io/prefix-dev/pixi:noble
Stage: build

# %arguments have to be defined at each stage
%arguments
    CUDA_VERSION=12
    ENVIRONMENT=gpu

%files
./pixi.toml /app/
./pixi.lock /app/
./.gitignore /app/

%post
#!/bin/bash
export CONDA_OVERRIDE_CUDA={{ CUDA_VERSION }}
cd /app/
pixi info
pixi install --locked --environment {{ ENVIRONMENT }}
echo "#!/bin/bash" &gt; /app/entrypoint.sh &amp;&amp; \
pixi shell-hook --environment {{ ENVIRONMENT }} -s bash &gt;&gt; /app/entrypoint.sh &amp;&amp; \
echo 'exec "$@"' &gt;&gt; /app/entrypoint.sh


Bootstrap: docker
From: ghcr.io/prefix-dev/pixi:noble
Stage: final

%arguments
    ENVIRONMENT=gpu

%files from build
/app/.pixi/envs/{{ ENVIRONMENT }} /app/.pixi/envs/{{ ENVIRONMENT }}
/app/pixi.toml /app/pixi.toml
/app/pixi.lock /app/pixi.lock
/app/.gitignore /app/.gitignore
# The ignore files are needed for 'pixi run' to work in the container
/app/.pixi/.gitignore /app/.pixi/.gitignore
/app/.pixi/.condapackageignore /app/.pixi/.condapackageignore
/app/entrypoint.sh /app/entrypoint.sh

%files
./app /app/src

%post
#!/bin/bash
cd /app/
pixi info
chmod +x /app/entrypoint.sh

%runscript
#!/bin/bash
/app/entrypoint.sh "$@"

%startscript
#!/bin/bash
/app/entrypoint.sh "$@"

%test
#!/bin/bash -e
. /app/entrypoint.sh
pixi info
pixi list


</code></pre>
<p>Let’s break this down too.</p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div>
  Apptainer walkthrough
  </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<ul><li><p>The Apptainer definition file is broken out into specific <a href="https://apptainer.org/docs/user/main/definition_files.html#sections" class="external-link">operation
sections</a> prefixed by <code>%</code> (e.g. <code>files</code>,
<code>post</code>).</p></li>
<li><p>The Apptainer definition file assumes it is being built from a
version control repository where any code that it will need to execute
later exists under the repository’s <code>src/</code> directory and the
Pixi workspace’s <code>pixi.toml</code> manifest file and
<code>pixi.lock</code> lock file exist at the top level of the
repository.</p></li>
<li><p>The <a href="https://apptainer.org/docs/user/main/definition_files.html#arguments" class="external-link"><code>arguments</code>
section</a> allows for variables — which appear as
<code>{{ variable }}</code> in the rest of the file — to be set at the
stage scope that can be set with the build options
<code>--build-arg</code> or <code>--build-arg-file</code>.</p></li>
</ul><pre><code>%arguments
    CUDA_VERSION=12
    ENVIRONMENT=gpu</code></pre>
<ul><li>The <a href="https://apptainer.org/docs/user/main/definition_files.html#files" class="external-link"><code>files</code>
section</a> allows for a mapping of what files should be copied from a
build context (e.g. the local file system) to the container file
system</li>
</ul><pre class="singularity"><code>%files
./pixi.toml /app/
./pixi.lock /app/
./.gitignore /app/</code></pre>
<ul><li>The <a href="https://apptainer.org/docs/user/main/definition_files.html#post" class="external-link"><code>post</code>
section</a> runs commands listed in it as a shell script executed in a
clean shell environment that does not have any pre-existing build
environment context. It is not reasonable to expect that the container
image build machine contains GPUs. To have Pixi still be able to install
an environment that uses CUDA when there is no virtual package set the
<code>__cuda</code> <a href="https://docs.conda.io/projects/conda/en/stable/user-guide/tasks/manage-virtual.html#overriding-detected-packages" class="external-link">override
environment variable <code>CONDA_OVERRIDE_CUDA</code></a>.</li>
</ul><pre><code>%post
#!/bin/bash
export CONDA_OVERRIDE_CUDA={{ CUDA_VERSION }}
...</code></pre>
<ul><li>The definition files uses a <a href="https://apptainer.org/docs/user/main/definition_files.html#multi-stage-builds" class="external-link">multi-stage
build</a> where it first installs the target environment
<code>&lt;environment&gt;</code> and then creates an
<code>entrypoint.sh</code> script script that will be used as a <a href="https://apptainer.org/docs/user/main/definition_files.html#runscript" class="external-link"><code>runscript</code></a>
using <a href="https://pixi.sh/latest/reference/cli/pixi/shell-hook/" class="external-link"><code>pixi shell-hook</code></a>
to automatically activate the environment when the container image is
run.</li>
</ul><pre><code>...
cd /app/
pixi info
pixi install --locked --environment {{ ENVIRONMENT }}
echo "#!/bin/bash" &gt; /app/entrypoint.sh &amp;&amp; \
pixi shell-hook --environment {{ ENVIRONMENT }} -s bash &gt;&gt; /app/entrypoint.sh &amp;&amp; \
echo 'exec "$@"' &gt;&gt; /app/entrypoint.sh</code></pre>
<ul><li>The next stage of the build starts from a new container instance and
then copies the installed environment and files <strong>from</strong>
the <code>build</code> stage into the <code>final</code> container
image. This can reduce the total size of the final container image if
there were additional build tools that needed to get installed in the
build phase that aren’t required for runtime in production.</li>
</ul><pre><code>Bootstrap: docker
From: ghcr.io/prefix-dev/pixi:noble
Stage: final

%arguments
    ENVIRONMENT=gpu

%files from build
/app/.pixi/envs/{{ ENVIRONMENT }} /app/.pixi/envs/{{ ENVIRONMENT }}
/app/pixi.toml /app/pixi.toml
/app/pixi.lock /app/pixi.lock
/app/.gitignore /app/.gitignore
# The ignore files are needed for 'pixi run' to work in the container
/app/.pixi/.gitignore /app/.pixi/.gitignore
/app/.pixi/.condapackageignore /app/.pixi/.condapackageignore
/app/entrypoint.sh /app/entrypoint.sh</code></pre>
<ul><li>By repeating the <code>files</code> section we can also copy in the
source code</li>
</ul><pre><code>%files
./app /app/src</code></pre>
<ul><li>The <code>post</code> section then verifies that the Pixi workspace
is valid and makes the <code>/app/entrypoint.sh</code> executable</li>
</ul><pre><code>%post
#!/bin/bash
cd /app/
pixi info
chmod +x /app/entrypoint.sh</code></pre>
<ul><li>The <a href="https://apptainer.org/docs/user/main/definition_files.html#runscript" class="external-link"><code>runscript</code>
section</a> defines a shell script that will get executed when the
container image is run (either via the <a href="https://apptainer.org/docs/user/main/cli/apptainer_run.html" class="external-link"><code>apptainer run</code></a>
command or by <a href="https://apptainer.org/docs/user/main/quick_start.html#runcontainer" class="external-link">executing
the container directly as a command</a>).</li>
</ul><pre><code>%runscript
#!/bin/bash
/app/entrypoint.sh "$@"</code></pre>
<ul><li>We also define a <a href="https://apptainer.org/docs/user/main/definition_files.html#startscript" class="external-link"><code>startscript</code>
section</a> that is the same as the <code>runscript</code>’s contents
that is executed when the <a href="https://apptainer.org/docs/user/main/cli/apptainer_instance_start.html" class="external-link"><code>instance start</code></a>
command is executed (which creates a container instances that starts
running in the background).</li>
</ul><pre><code>%startscript
#!/bin/bash
/app/entrypoint.sh "$@"</code></pre>
<ul><li>Finally, the <a href="https://apptainer.org/docs/user/main/definition_files.html#test" class="external-link"><code>test</code>
section</a> defines a script that will be executed in the built
container at the end of the build process. This allows for validation of
the container functionality before it is distributed.</li>
</ul><pre><code>%test
#!/bin/bash -e
. /app/entrypoint.sh
pixi info
pixi list</code></pre>
</div>
</div>
</div>
</div>
<p>With this Apptainer defintion file the container image can then be
built with <code>apptainer build</code></p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="ex">apptainer</span> build <span class="op">&lt;</span>container image name<span class="op">&gt;</span>.sif <span class="op">&lt;</span>definition file name<span class="op">&gt;</span>.def</span></code></pre>
</div>
<p>and can optionally have the stage scoped variables set with</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="ex">apptainer</span> build <span class="op">&lt;</span>container image name<span class="op">&gt;</span>.sif <span class="at">--build-arg</span> CUDA_VERSION=12 <span class="at">--build-arg</span> ENVIRONMENT_NAME=gpu <span class="op">&lt;</span>definition file name<span class="op">&gt;</span>.def</span></code></pre>
</div>
<div class="section level3">
<h3 id="automation-with-github-actions-workflows-1">Automation with GitHub Actions workflows<a class="anchor" aria-label="anchor" href="#automation-with-github-actions-workflows-1"></a></h3>
<p>In the personal GitHub repository that we’ve been working in, create
a GitHub Actions workflow directory from the top level of the
repository</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> .github/workflows</span></code></pre>
</div>
<p>and then add the following workflow file as
<code>.github/workflows/apptainer.yaml</code></p>
<div class="codewrapper sourceCode" id="cb30">
<h3 class="code-label">YAML<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode yaml" tabindex="0"><code class="sourceCode yaml"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">name</span><span class="kw">:</span><span class="at"> Apptainer Images</span></span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a><span class="fu">on</span><span class="kw">:</span></span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="at">  </span><span class="fu">push</span><span class="kw">:</span></span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="at">    </span><span class="fu">branches</span><span class="kw">:</span></span>
<span id="cb30-6"><a href="#cb30-6" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> main</span></span>
<span id="cb30-7"><a href="#cb30-7" tabindex="-1"></a><span class="at">    </span><span class="fu">tags</span><span class="kw">:</span></span>
<span id="cb30-8"><a href="#cb30-8" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'v*'</span></span>
<span id="cb30-9"><a href="#cb30-9" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb30-10"><a href="#cb30-10" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/pixi.toml'</span></span>
<span id="cb30-11"><a href="#cb30-11" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/pixi.lock'</span></span>
<span id="cb30-12"><a href="#cb30-12" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/apptainer.def'</span></span>
<span id="cb30-13"><a href="#cb30-13" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/app/**'</span></span>
<span id="cb30-14"><a href="#cb30-14" tabindex="-1"></a><span class="at">  </span><span class="fu">pull_request</span><span class="kw">:</span></span>
<span id="cb30-15"><a href="#cb30-15" tabindex="-1"></a><span class="at">    </span><span class="fu">paths</span><span class="kw">:</span></span>
<span id="cb30-16"><a href="#cb30-16" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/pixi.toml'</span></span>
<span id="cb30-17"><a href="#cb30-17" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/pixi.lock'</span></span>
<span id="cb30-18"><a href="#cb30-18" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/apptainer.def'</span></span>
<span id="cb30-19"><a href="#cb30-19" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="st">'cuda-exercise/app/**'</span></span>
<span id="cb30-20"><a href="#cb30-20" tabindex="-1"></a><span class="at">  </span><span class="fu">release</span><span class="kw">:</span></span>
<span id="cb30-21"><a href="#cb30-21" tabindex="-1"></a><span class="at">    </span><span class="fu">types</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="at">published</span><span class="kw">]</span></span>
<span id="cb30-22"><a href="#cb30-22" tabindex="-1"></a><span class="at">  </span><span class="fu">workflow_dispatch</span><span class="kw">:</span></span>
<span id="cb30-23"><a href="#cb30-23" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" tabindex="-1"></a><span class="fu">concurrency</span><span class="kw">:</span></span>
<span id="cb30-25"><a href="#cb30-25" tabindex="-1"></a><span class="at">  </span><span class="fu">group</span><span class="kw">:</span><span class="at"> ${{ github.workflow }}-${{ github.ref }}</span></span>
<span id="cb30-26"><a href="#cb30-26" tabindex="-1"></a><span class="at">  </span><span class="fu">cancel-in-progress</span><span class="kw">:</span><span class="at"> </span><span class="ch">true</span></span>
<span id="cb30-27"><a href="#cb30-27" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" tabindex="-1"></a><span class="fu">permissions</span><span class="kw">:</span><span class="at"> </span><span class="kw">{}</span></span>
<span id="cb30-29"><a href="#cb30-29" tabindex="-1"></a></span>
<span id="cb30-30"><a href="#cb30-30" tabindex="-1"></a><span class="fu">jobs</span><span class="kw">:</span></span>
<span id="cb30-31"><a href="#cb30-31" tabindex="-1"></a><span class="at">  </span><span class="fu">apptainer</span><span class="kw">:</span></span>
<span id="cb30-32"><a href="#cb30-32" tabindex="-1"></a><span class="at">    </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build and publish images</span></span>
<span id="cb30-33"><a href="#cb30-33" tabindex="-1"></a><span class="at">    </span><span class="fu">runs-on</span><span class="kw">:</span><span class="at"> ubuntu-latest</span></span>
<span id="cb30-34"><a href="#cb30-34" tabindex="-1"></a><span class="at">    </span><span class="fu">permissions</span><span class="kw">:</span></span>
<span id="cb30-35"><a href="#cb30-35" tabindex="-1"></a><span class="at">      </span><span class="fu">contents</span><span class="kw">:</span><span class="at"> read</span></span>
<span id="cb30-36"><a href="#cb30-36" tabindex="-1"></a><span class="at">      </span><span class="fu">packages</span><span class="kw">:</span><span class="at"> write</span></span>
<span id="cb30-37"><a href="#cb30-37" tabindex="-1"></a></span>
<span id="cb30-38"><a href="#cb30-38" tabindex="-1"></a><span class="at">    </span><span class="fu">steps</span><span class="kw">:</span></span>
<span id="cb30-39"><a href="#cb30-39" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Free disk space</span></span>
<span id="cb30-40"><a href="#cb30-40" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> AdityaGarg8/remove-unwanted-software@v5</span></span>
<span id="cb30-41"><a href="#cb30-41" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb30-42"><a href="#cb30-42" tabindex="-1"></a><span class="at">          </span><span class="fu">remove-android</span><span class="kw">:</span><span class="at"> </span><span class="st">'true'</span></span>
<span id="cb30-43"><a href="#cb30-43" tabindex="-1"></a><span class="at">          </span><span class="fu">remove-dotnet</span><span class="kw">:</span><span class="at"> </span><span class="st">'true'</span></span>
<span id="cb30-44"><a href="#cb30-44" tabindex="-1"></a><span class="at">          </span><span class="fu">remove-haskell</span><span class="kw">:</span><span class="at"> </span><span class="st">'true'</span></span>
<span id="cb30-45"><a href="#cb30-45" tabindex="-1"></a></span>
<span id="cb30-46"><a href="#cb30-46" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Checkout</span></span>
<span id="cb30-47"><a href="#cb30-47" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> actions/checkout@v4</span></span>
<span id="cb30-48"><a href="#cb30-48" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb30-49"><a href="#cb30-49" tabindex="-1"></a><span class="at">          </span><span class="fu">fetch-depth</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb30-50"><a href="#cb30-50" tabindex="-1"></a></span>
<span id="cb30-51"><a href="#cb30-51" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Get commit SHA</span></span>
<span id="cb30-52"><a href="#cb30-52" tabindex="-1"></a><span class="at">        </span><span class="fu">id</span><span class="kw">:</span><span class="at"> meta</span></span>
<span id="cb30-53"><a href="#cb30-53" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb30-54"><a href="#cb30-54" tabindex="-1"></a>            # Get the short commit SHA (first 7 characters)</span>
<span id="cb30-55"><a href="#cb30-55" tabindex="-1"></a>            SHA=$(git rev-parse --short HEAD)</span>
<span id="cb30-56"><a href="#cb30-56" tabindex="-1"></a>            echo "sha=sha-$SHA" &gt;&gt; $GITHUB_OUTPUT</span>
<span id="cb30-57"><a href="#cb30-57" tabindex="-1"></a></span>
<span id="cb30-58"><a href="#cb30-58" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Install Apptainer</span></span>
<span id="cb30-59"><a href="#cb30-59" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> eWaterCycle/setup-apptainer@v2</span></span>
<span id="cb30-60"><a href="#cb30-60" tabindex="-1"></a></span>
<span id="cb30-61"><a href="#cb30-61" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Build container from definition file</span></span>
<span id="cb30-62"><a href="#cb30-62" tabindex="-1"></a><span class="at">        </span><span class="fu">working-directory</span><span class="kw">:</span><span class="at"> ./cuda-exercise</span></span>
<span id="cb30-63"><a href="#cb30-63" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> apptainer build gpu-noble-cuda-12.9.sif apptainer.def</span></span>
<span id="cb30-64"><a href="#cb30-64" tabindex="-1"></a></span>
<span id="cb30-65"><a href="#cb30-65" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Test container</span></span>
<span id="cb30-66"><a href="#cb30-66" tabindex="-1"></a><span class="at">        </span><span class="fu">working-directory</span><span class="kw">:</span><span class="at"> ./cuda-exercise</span></span>
<span id="cb30-67"><a href="#cb30-67" tabindex="-1"></a><span class="at">        </span><span class="fu">run</span><span class="kw">:</span><span class="at"> apptainer test gpu-noble-cuda-12.9.sif</span></span>
<span id="cb30-68"><a href="#cb30-68" tabindex="-1"></a></span>
<span id="cb30-69"><a href="#cb30-69" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Login to GitHub Container Registry</span></span>
<span id="cb30-70"><a href="#cb30-70" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb30-71"><a href="#cb30-71" tabindex="-1"></a><span class="at">        </span><span class="fu">uses</span><span class="kw">:</span><span class="at"> docker/login-action@v3</span></span>
<span id="cb30-72"><a href="#cb30-72" tabindex="-1"></a><span class="at">        </span><span class="fu">with</span><span class="kw">:</span></span>
<span id="cb30-73"><a href="#cb30-73" tabindex="-1"></a><span class="at">          </span><span class="fu">registry</span><span class="kw">:</span><span class="at"> ghcr.io</span></span>
<span id="cb30-74"><a href="#cb30-74" tabindex="-1"></a><span class="at">          </span><span class="fu">username</span><span class="kw">:</span><span class="at"> ${{ github.repository_owner }}</span></span>
<span id="cb30-75"><a href="#cb30-75" tabindex="-1"></a><span class="at">          </span><span class="fu">password</span><span class="kw">:</span><span class="at"> ${{ secrets.GITHUB_TOKEN }}</span></span>
<span id="cb30-76"><a href="#cb30-76" tabindex="-1"></a></span>
<span id="cb30-77"><a href="#cb30-77" tabindex="-1"></a><span class="at">      </span><span class="kw">-</span><span class="at"> </span><span class="fu">name</span><span class="kw">:</span><span class="at"> Deploy built container</span></span>
<span id="cb30-78"><a href="#cb30-78" tabindex="-1"></a><span class="at">        </span><span class="fu">if</span><span class="kw">:</span><span class="at"> github.event_name != 'pull_request'</span></span>
<span id="cb30-79"><a href="#cb30-79" tabindex="-1"></a><span class="at">        </span><span class="fu">working-directory</span><span class="kw">:</span><span class="at"> ./cuda-exercise</span></span>
<span id="cb30-80"><a href="#cb30-80" tabindex="-1"></a><span class="fu">        run</span><span class="kw">: </span><span class="ch">|</span></span>
<span id="cb30-81"><a href="#cb30-81" tabindex="-1"></a>            apptainer push gpu-noble-cuda-12.9.sif oras://ghcr.io/${{ github.repository }}:apptainer-gpu-noble-cuda-12.9</span>
<span id="cb30-82"><a href="#cb30-82" tabindex="-1"></a>            apptainer push gpu-noble-cuda-12.9.sif oras://ghcr.io/${{ github.repository }}:apptainer-gpu-noble-cuda-12.9-${{ steps.meta.outputs.sha }}</span></code></pre>
</div>
<p>This will build your Apptainer definition file in GitHub Actions CI
into a <code>.sif</code> container image and then deploy it to the <a href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry" class="external-link">GitHub
Container Registry</a> (<code>ghcr</code>) associated with your
repository.</p>
<div id="version-control-1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<span class="callout-header">Callout</span>
<div id="version-control-1" class="callout-inner">
<h3 class="callout-title">Version Control</h3>
<div class="callout-content">
<p>We now want to use these tools to build our Pixi environment into an
Apptainer Linux container.</p>
<p>On a <strong>new branch</strong> in your repository, add and commit
the files from this episode.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">git</span> add cuda-exercise/apptainer.def</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="fu">git</span> add .github/workflows/apptainer.yaml</span></code></pre>
</div>
<p>Then push your branch to your remote on GitHub</p>
<div class="codewrapper sourceCode" id="cb32">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin HEAD</span></code></pre>
</div>
<p>and make a pull request to merge your changes into your remote’s
default branch.</p>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<span class="callout-header">Key Points</span>
<div class="callout-inner">
<div class="callout-content">
<ul><li>Pixi environments can be easily installed into Linux
containers.</li>
<li>As Pixi environments contain the entire software environment, the
Linux container build script can simply install the Pixi
environment.</li>
<li>Using GitHub Actions workflows allows for the build process to
happen automatically through CI/CD.</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section><div class="footnotes footnotes-end-of-document">
<hr><ol><li id="fn1"><p>Which is a valid and effective solution.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol></div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/cuda-conda-pacakges.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/htc-systems.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/cuda-conda-pacakges.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: CUDA conda packages
        </a>
        <a class="chapter-link float-end" href="../instructor/htc-systems.html" rel="next">
          Next: Using Pixi...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/edit/main/episodes/pixi-deployment.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/" class="external-link">Source</a></p>
				<p><a href="https://github.com/carpentries-incubator/reproducible-ml-workflows/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:matthew.feickert@cern.ch">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.17.1" class="external-link">sandpaper (0.17.1)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.7" class="external-link">varnish (1.0.7)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://carpentries-incubator.github.io/reproducible-ml-workflows/instructor/pixi-deployment.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, lesson, The Carpentries, machine learning, CUDA, hardware acceleration, reproducible",
  "name": "Deploying Pixi environments with Linux containers",
  "creativeWorkStatus": "active",
  "url": "https://carpentries-incubator.github.io/reproducible-ml-workflows/instructor/pixi-deployment.html",
  "identifier": "https://carpentries-incubator.github.io/reproducible-ml-workflows/instructor/pixi-deployment.html",
  "dateCreated": "2025-03-16",
  "dateModified": "2025-10-28",
  "datePublished": "2025-10-28"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

